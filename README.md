# CRM Система управления задачами на Flask

Веб-приложение для управления задачами с назначением исполнителей, контролем выполнения, отчетами и балльной системой. Полноценная CRM-система с ролями администратора и пользователя.

## Возможности

### Для всех пользователей:
- ✅ Регистрация и авторизация пользователей
- ✅ Создание задач с назначением исполнителей
- ✅ Управление задачами (создание, редактирование, удаление)
- ✅ Отслеживание статусов задач (новая, в работе, выполнена, отменена)
- ✅ Приоритеты задач (низкий, средний, высокий, срочный)
- ✅ Установка дедлайнов для задач
- ✅ Балльная система - начисление баллов за выполнение задач
- ✅ Просмотр профиля с статистикой
- ✅ Отчеты и аналитика
- ✅ История активности

### Для администраторов:
- ✅ Управление пользователями
- ✅ Изменение ролей пользователей
- ✅ Просмотр всех задач в системе
- ✅ Расширенная аналитика и отчеты
- ✅ Рейтинг пользователей по баллам

## Установка

1. Установите зависимости:
```bash
pip install -r requirements.txt
```

2. Запустите приложение:
```bash
python app.py
```

3. Откройте браузер и перейдите по адресу: `http://127.0.0.1:5000`

## Первый вход

При первом запуске автоматически создается администратор:
- **Логин**: `admin`
- **Пароль**: `admin123`

⚠️ **Важно**: Измените пароль администратора после первого входа!

## Использование

### Регистрация и вход
1. Создайте новый аккаунт через страницу регистрации
2. Войдите в систему используя свои учетные данные

### Работа с задачами
1. **Создание задачи**: 
   - Нажмите "Создать задачу"
   - Укажите название, описание, приоритет
   - Назначьте исполнителя (опционально)
   - Установите дедлайн (опционально)

2. **Управление задачами**:
   - Просматривайте задачи, назначенные вам
   - Изменяйте статус задачи (новая → в работе → выполнена)
   - Редактируйте задачи (если вы создатель или админ)
   - Удаляйте задачи (если вы создатель или админ)

3. **Балльная система**:
   - За выполнение задачи начисляются баллы в зависимости от приоритета:
     - Низкий: 10 баллов
     - Средний: 25 баллов
     - Высокий: 50 баллов
     - Срочный: 100 баллов

### Отчеты
- Просматривайте статистику по задачам
- Анализируйте выполнение по периодам (неделя, месяц, все время)
- Смотрите рейтинг пользователей по баллам
- Изучайте историю активности

### Управление пользователями (только для админов)
- Просматривайте список всех пользователей
- Изменяйте роли пользователей
- Просматривайте профили пользователей

## Структура проекта

```
To-Do List (Список дел)/
├── app.py                 # Основной файл приложения
├── requirements.txt       # Зависимости проекта
├── instance/
│   └── todo.db           # База данных SQLite (создается автоматически)
├── todo_app.log          # Файл логов (создается автоматически)
└── templates/            # HTML шаблоны
    ├── base.html         # Базовый шаблон
    ├── login.html        # Страница входа
    ├── register.html     # Страница регистрации
    ├── dashboard.html    # Панель управления
    ├── create_task.html  # Создание задачи
    ├── edit_task.html    # Редактирование задачи
    ├── reports.html      # Отчеты и аналитика
    ├── users.html        # Управление пользователями (админ)
    └── user_profile.html # Профиль пользователя
```

## База данных

Приложение использует SQLite базу данных со следующими таблицами:

- **User**: 
  - Информация о пользователях (username, email, password_hash, role, points)
  - Роли: 'admin' или 'user'
  - Баллы за выполнение задач

- **Task**: 
  - Задачи (title, description, status, priority, deadline)
  - Связи с создателем (creator_id) и исполнителем (assignee_id)
  - Статусы: new, in_progress, completed, cancelled
  - Приоритеты: low, medium, high, urgent

- **Activity**: 
  - История активности пользователей
  - Действия: created, assigned, updated, completed, status_changed, role_changed

## Роли и права доступа

### Пользователь (user):
- Создание задач
- Просмотр своих задач (назначенных и созданных)
- Изменение статуса назначенных задач
- Редактирование созданных задач
- Просмотр своего профиля и отчетов

### Администратор (admin):
- Все права пользователя
- Просмотр всех задач в системе
- Управление пользователями
- Изменение ролей пользователей
- Расширенная аналитика

## Балльная система

Баллы начисляются автоматически при завершении задачи:
- Система рассчитывает баллы на основе приоритета задачи
- Баллы добавляются к общему счету исполнителя
- Рейтинг пользователей отображается в отчетах
- Администратор может видеть рейтинг всех пользователей

## Логирование

Все действия пользователей логируются в файл `todo_app.log` и выводятся в консоль. Логи включают:
- Регистрацию новых пользователей
- Вход и выход из системы
- Создание, редактирование и удаление задач
- Изменение статусов задач
- Начисление баллов
- Попытки несанкционированного доступа
- Изменение ролей пользователей

## Безопасность

- Пароли хранятся в виде хешей (Werkzeug)
- Проверка прав доступа к задачам и функциям
- Защита от SQL-инъекций через SQLAlchemy ORM
- Сессии для управления состоянием пользователя
- Декораторы для проверки прав доступа (@login_required, @admin_required)

## Примечания

⚠️ **Важно**: 
- В production окружении обязательно измените `SECRET_KEY` в файле `app.py` на случайную строку!
- Измените пароль администратора после первого входа!
- Регулярно делайте резервные копии базы данных!

## Технологии

- **Flask** - веб-фреймворк
- **SQLAlchemy** - ORM для работы с базой данных
- **SQLite** - база данных
- **Werkzeug** - хеширование паролей
- **Python** - язык программирования
